use std::fmt;

#[rustfmt::skip]
pub const CP437CHARS: &[char] = &[
    '\0', '☺', '☻', '♥', '♦', '♣', '♠', '•', '◘', '○', '◙', '♂', '♀', '♪', '♫', '☼',
    '►', '◄', '↕', '‼', '¶', '§', '▬', '↨', '↑', '↓', '→', '←', '∟', '↔', '▲', '▼', 
    ' ', '!', '"', '#', '$', '%', '&', '\'', '(', ')', '*', '+', ',', '-', '.', '/',
    '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', ':', ';', '<', '=', '>', '?',
    '@', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O',
    'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '[', '\\', ']', '^', '_', 
    '`', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 
    'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '{', '|', '}', '~', '⌂', 
    'Ç', 'ü', 'é', 'â', 'ä', 'à', 'å', 'ç', 'ê', 'ë', 'è', 'ï', 'î', 'ì', 'Ä', 'Å', 
    'É', 'æ', 'Æ', 'ô', 'ö', 'ò', 'û', 'ù', 'ÿ', 'Ö', 'Ü', '¢', '£', '¥', '₧', 'ƒ', 
    'á', 'í', 'ó', 'ú', 'ñ', 'Ñ', 'ª', 'º', '¿', '⌐', '¬', '½', '¼', '¡', '«', '»', 
    '░', '▒', '▓', '│', '┤', '╡', '╢', '╖', '╕', '╣', '║', '╗', '╝', '╜', '╛', '┐', 
    '└', '┴', '┬', '├', '─', '┼', '╞', '╟', '╚', '╔', '╩', '╦', '╠', '═', '╬', '╧', 
    '╨', '╤', '╥', '╙', '╘', '╒', '╓', '╫', '╪', '┘', '┌', '█', '▄', '▌', '▐', '▀', 
    'α', 'ß', 'Γ', 'π', 'Σ', 'σ', 'µ', 'τ', 'Φ', 'Θ', 'Ω', 'δ', '∞', 'φ', 'ε', '∩', 
    '≡', '±', '≥', '≤', '⌠', '⌡', '÷', '≈', '°', '∙', '·', '√', 'ⁿ', '²', '■', '\u{a0}'
];

#[derive(Debug, Default, PartialEq, Eq, Clone, Copy)]
pub struct Char437(pub(crate) u8);

impl Char437 {
    pub fn offset(&self) -> (u8, u8) {
        (self.0 % 16, self.0 / 16)
    }
}

impl From<u8> for Char437 {
    fn from(value : u8) -> Self {
        Self(value)
    }
}

impl From<&Char437> for char {
    fn from(value : &Char437) -> Self {
        match value {
            Char437(0) => '\0',
            Char437(1) => '☺',
            Char437(2) => '☻',
            Char437(3) => '♥',
            Char437(4) => '♦',
            Char437(5) => '♣',
            Char437(6) => '♠',
            Char437(7) => '•',
            Char437(8) => '◘',
            Char437(9) => '○',
            Char437(10) => '◙',
            Char437(11) => '♂',
            Char437(12) => '♀',
            Char437(13) => '♪',
            Char437(14) => '♫',
            Char437(15) => '☼',
            Char437(16) => '►',
            Char437(17) => '◄',
            Char437(18) => '↕',
            Char437(19) => '‼',
            Char437(20) => '¶',
            Char437(21) => '§',
            Char437(22) => '▬',
            Char437(23) => '↨',
            Char437(24) => '↑',
            Char437(25) => '↓',
            Char437(26) => '→',
            Char437(27) => '←',
            Char437(28) => '∟',
            Char437(29) => '↔',
            Char437(30) => '▲',
            Char437(31) => '▼',
            Char437(32) => ' ',
            Char437(33) => '!',
            Char437(34) => '"',
            Char437(35) => '#',
            Char437(36) => '$',
            Char437(37) => '%',
            Char437(38) => '&',
            Char437(39) => '\'',
            Char437(40) => '(',
            Char437(41) => ')',
            Char437(42) => '*',
            Char437(43) => '+',
            Char437(44) => ',',
            Char437(45) => '-',
            Char437(46) => '.',
            Char437(47) => '/',
            Char437(48) => '0',
            Char437(49) => '1',
            Char437(50) => '2',
            Char437(51) => '3',
            Char437(52) => '4',
            Char437(53) => '5',
            Char437(54) => '6',
            Char437(55) => '7',
            Char437(56) => '8',
            Char437(57) => '9',
            Char437(58) => ':',
            Char437(59) => ';',
            Char437(60) => '<',
            Char437(61) => '=',
            Char437(62) => '>',
            Char437(63) => '?',
            Char437(64) => '@',
            Char437(65) => 'A',
            Char437(66) => 'B',
            Char437(67) => 'C',
            Char437(68) => 'D',
            Char437(69) => 'E',
            Char437(70) => 'F',
            Char437(71) => 'G',
            Char437(72) => 'H',
            Char437(73) => 'I',
            Char437(74) => 'J',
            Char437(75) => 'K',
            Char437(76) => 'L',
            Char437(77) => 'M',
            Char437(78) => 'N',
            Char437(79) => 'O',
            Char437(80) => 'P',
            Char437(81) => 'Q',
            Char437(82) => 'R',
            Char437(83) => 'S',
            Char437(84) => 'T',
            Char437(85) => 'U',
            Char437(86) => 'V',
            Char437(87) => 'W',
            Char437(88) => 'X',
            Char437(89) => 'Y',
            Char437(90) => 'Z',
            Char437(91) => '[',
            Char437(92) => '\\',
            Char437(93) => ']',
            Char437(94) => '^',
            Char437(95) => '_',
            Char437(96) => '`',
            Char437(97) => 'a',
            Char437(98) => 'b',
            Char437(99) => 'c',
            Char437(100) => 'd',
            Char437(101) => 'e',
            Char437(102) => 'f',
            Char437(103) => 'g',
            Char437(104) => 'h',
            Char437(105) => 'i',
            Char437(106) => 'j',
            Char437(107) => 'k',
            Char437(108) => 'l',
            Char437(109) => 'm',
            Char437(110) => 'n',
            Char437(111) => 'o',
            Char437(112) => 'p',
            Char437(113) => 'q',
            Char437(114) => 'r',
            Char437(115) => 's',
            Char437(116) => 't',
            Char437(117) => 'u',
            Char437(118) => 'v',
            Char437(119) => 'w',
            Char437(120) => 'x',
            Char437(121) => 'y',
            Char437(122) => 'z',
            Char437(123) => '{',
            Char437(124) => '|',
            Char437(125) => '}',
            Char437(126) => '~',
            Char437(127) => '⌂',
            Char437(128) => 'Ç',
            Char437(129) => 'ü',
            Char437(130) => 'é',
            Char437(131) => 'â',
            Char437(132) => 'ä',
            Char437(133) => 'à',
            Char437(134) => 'å',
            Char437(135) => 'ç',
            Char437(136) => 'ê',
            Char437(137) => 'ë',
            Char437(138) => 'è',
            Char437(139) => 'ï',
            Char437(140) => 'î',
            Char437(141) => 'ì',
            Char437(142) => 'Ä',
            Char437(143) => 'Å',
            Char437(144) => 'É',
            Char437(145) => 'æ',
            Char437(146) => 'Æ',
            Char437(147) => 'ô',
            Char437(148) => 'ö',
            Char437(149) => 'ò',
            Char437(150) => 'û',
            Char437(151) => 'ù',
            Char437(152) => 'ÿ',
            Char437(153) => 'Ö',
            Char437(154) => 'Ü',
            Char437(155) => '¢',
            Char437(156) => '£',
            Char437(157) => '¥',
            Char437(158) => '₧',
            Char437(159) => 'ƒ',
            Char437(160) => 'á',
            Char437(161) => 'í',
            Char437(162) => 'ó',
            Char437(163) => 'ú',
            Char437(164) => 'ñ',
            Char437(165) => 'Ñ',
            Char437(166) => 'ª',
            Char437(167) => 'º',
            Char437(168) => '¿',
            Char437(169) => '⌐',
            Char437(170) => '¬',
            Char437(171) => '½',
            Char437(172) => '¼',
            Char437(173) => '¡',
            Char437(174) => '«',
            Char437(175) => '»',
            Char437(176) => '░',
            Char437(177) => '▒',
            Char437(178) => '▓',
            Char437(179) => '│',
            Char437(180) => '┤',
            Char437(181) => '╡',
            Char437(182) => '╢',
            Char437(183) => '╖',
            Char437(184) => '╕',
            Char437(185) => '╣',
            Char437(186) => '║',
            Char437(187) => '╗',
            Char437(188) => '╝',
            Char437(189) => '╜',
            Char437(190) => '╛',
            Char437(191) => '┐',
            Char437(192) => '└',
            Char437(193) => '┴',
            Char437(194) => '┬',
            Char437(195) => '├',
            Char437(196) => '─',
            Char437(197) => '┼',
            Char437(198) => '╞',
            Char437(199) => '╟',
            Char437(200) => '╚',
            Char437(201) => '╔',
            Char437(202) => '╩',
            Char437(203) => '╦',
            Char437(204) => '╠',
            Char437(205) => '═',
            Char437(206) => '╬',
            Char437(207) => '╧',
            Char437(208) => '╨',
            Char437(209) => '╤',
            Char437(210) => '╥',
            Char437(211) => '╙',
            Char437(212) => '╘',
            Char437(213) => '╒',
            Char437(214) => '╓',
            Char437(215) => '╫',
            Char437(216) => '╪',
            Char437(217) => '┘',
            Char437(218) => '┌',
            Char437(219) => '█',
            Char437(220) => '▄',
            Char437(221) => '▌',
            Char437(222) => '▐',
            Char437(223) => '▀',
            Char437(224) => 'α',
            Char437(225) => 'ß',
            Char437(226) => 'Γ',
            Char437(227) => 'π',
            Char437(228) => 'Σ',
            Char437(229) => 'σ',
            Char437(230) => 'µ',
            Char437(231) => 'τ',
            Char437(232) => 'Φ',
            Char437(233) => 'Θ',
            Char437(234) => 'Ω',
            Char437(235) => 'δ',
            Char437(236) => '∞',
            Char437(237) => 'φ',
            Char437(238) => 'ε',
            Char437(239) => '∩',
            Char437(240) => '≡',
            Char437(241) => '±',
            Char437(242) => '≥',
            Char437(243) => '≤',
            Char437(244) => '⌠',
            Char437(245) => '⌡',
            Char437(246) => '÷',
            Char437(247) => '≈',
            Char437(248) => '°',
            Char437(249) => '∙',
            Char437(250) => '·',
            Char437(251) => '√',
            Char437(252) => 'ⁿ',
            Char437(253) => '²',
            Char437(254) => '■',
            Char437(255) => '\u{a0}',
        }
    }
}

impl From<Char437> for char {
    fn from(value : Char437) -> Self {
        char::from(&value)
    }
}

impl TryFrom<&char> for Char437 {
    type Error = ();

    fn try_from(value : &char) -> Result<Self, Self::Error> {
        match value {
            '\0' => Ok(Char437(0)),
            '☺' => Ok(Char437(1)),
            '☻' => Ok(Char437(2)),
            '♥' => Ok(Char437(3)),
            '♦' => Ok(Char437(4)),
            '♣' => Ok(Char437(5)),
            '♠' => Ok(Char437(6)),
            '•' => Ok(Char437(7)),
            '◘' => Ok(Char437(8)),
            '○' => Ok(Char437(9)),
            '◙' => Ok(Char437(10)),
            '♂' => Ok(Char437(11)),
            '♀' => Ok(Char437(12)),
            '♪' => Ok(Char437(13)),
            '♫' => Ok(Char437(14)),
            '☼' => Ok(Char437(15)),
            '►' => Ok(Char437(16)),
            '◄' => Ok(Char437(17)),
            '↕' => Ok(Char437(18)),
            '‼' => Ok(Char437(19)),
            '¶' => Ok(Char437(20)),
            '§' => Ok(Char437(21)),
            '▬' => Ok(Char437(22)),
            '↨' => Ok(Char437(23)),
            '↑' => Ok(Char437(24)),
            '↓' => Ok(Char437(25)),
            '→' => Ok(Char437(26)),
            '←' => Ok(Char437(27)),
            '∟' => Ok(Char437(28)),
            '↔' => Ok(Char437(29)),
            '▲' => Ok(Char437(30)),
            '▼' => Ok(Char437(31)),
            ' ' => Ok(Char437(32)),
            '!' => Ok(Char437(33)),
            '"' => Ok(Char437(34)),
            '#' => Ok(Char437(35)),
            '$' => Ok(Char437(36)),
            '%' => Ok(Char437(37)),
            '&' => Ok(Char437(38)),
            '\'' => Ok(Char437(39)),
            '(' => Ok(Char437(40)),
            ')' => Ok(Char437(41)),
            '*' => Ok(Char437(42)),
            '+' => Ok(Char437(43)),
            ',' => Ok(Char437(44)),
            '-' => Ok(Char437(45)),
            '.' => Ok(Char437(46)),
            '/' => Ok(Char437(47)),
            '0' => Ok(Char437(48)),
            '1' => Ok(Char437(49)),
            '2' => Ok(Char437(50)),
            '3' => Ok(Char437(51)),
            '4' => Ok(Char437(52)),
            '5' => Ok(Char437(53)),
            '6' => Ok(Char437(54)),
            '7' => Ok(Char437(55)),
            '8' => Ok(Char437(56)),
            '9' => Ok(Char437(57)),
            ':' => Ok(Char437(58)),
            ';' => Ok(Char437(59)),
            '<' => Ok(Char437(60)),
            '=' => Ok(Char437(61)),
            '>' => Ok(Char437(62)),
            '?' => Ok(Char437(63)),
            '@' => Ok(Char437(64)),
            'A' => Ok(Char437(65)),
            'B' => Ok(Char437(66)),
            'C' => Ok(Char437(67)),
            'D' => Ok(Char437(68)),
            'E' => Ok(Char437(69)),
            'F' => Ok(Char437(70)),
            'G' => Ok(Char437(71)),
            'H' => Ok(Char437(72)),
            'I' => Ok(Char437(73)),
            'J' => Ok(Char437(74)),
            'K' => Ok(Char437(75)),
            'L' => Ok(Char437(76)),
            'M' => Ok(Char437(77)),
            'N' => Ok(Char437(78)),
            'O' => Ok(Char437(79)),
            'P' => Ok(Char437(80)),
            'Q' => Ok(Char437(81)),
            'R' => Ok(Char437(82)),
            'S' => Ok(Char437(83)),
            'T' => Ok(Char437(84)),
            'U' => Ok(Char437(85)),
            'V' => Ok(Char437(86)),
            'W' => Ok(Char437(87)),
            'X' => Ok(Char437(88)),
            'Y' => Ok(Char437(89)),
            'Z' => Ok(Char437(90)),
            '[' => Ok(Char437(91)),
            '\\' => Ok(Char437(92)),
            ']' => Ok(Char437(93)),
            '^' => Ok(Char437(94)),
            '_' => Ok(Char437(95)),
            '`' => Ok(Char437(96)),
            'a' => Ok(Char437(97)),
            'b' => Ok(Char437(98)),
            'c' => Ok(Char437(99)),
            'd' => Ok(Char437(100)),
            'e' => Ok(Char437(101)),
            'f' => Ok(Char437(102)),
            'g' => Ok(Char437(103)),
            'h' => Ok(Char437(104)),
            'i' => Ok(Char437(105)),
            'j' => Ok(Char437(106)),
            'k' => Ok(Char437(107)),
            'l' => Ok(Char437(108)),
            'm' => Ok(Char437(109)),
            'n' => Ok(Char437(110)),
            'o' => Ok(Char437(111)),
            'p' => Ok(Char437(112)),
            'q' => Ok(Char437(113)),
            'r' => Ok(Char437(114)),
            's' => Ok(Char437(115)),
            't' => Ok(Char437(116)),
            'u' => Ok(Char437(117)),
            'v' => Ok(Char437(118)),
            'w' => Ok(Char437(119)),
            'x' => Ok(Char437(120)),
            'y' => Ok(Char437(121)),
            'z' => Ok(Char437(122)),
            '{' => Ok(Char437(123)),
            '|' => Ok(Char437(124)),
            '}' => Ok(Char437(125)),
            '~' => Ok(Char437(126)),
            '⌂' => Ok(Char437(127)),
            'Ç' => Ok(Char437(128)),
            'ü' => Ok(Char437(129)),
            'é' => Ok(Char437(130)),
            'â' => Ok(Char437(131)),
            'ä' => Ok(Char437(132)),
            'à' => Ok(Char437(133)),
            'å' => Ok(Char437(134)),
            'ç' => Ok(Char437(135)),
            'ê' => Ok(Char437(136)),
            'ë' => Ok(Char437(137)),
            'è' => Ok(Char437(138)),
            'ï' => Ok(Char437(139)),
            'î' => Ok(Char437(140)),
            'ì' => Ok(Char437(141)),
            'Ä' => Ok(Char437(142)),
            'Å' => Ok(Char437(143)),
            'É' => Ok(Char437(144)),
            'æ' => Ok(Char437(145)),
            'Æ' => Ok(Char437(146)),
            'ô' => Ok(Char437(147)),
            'ö' => Ok(Char437(148)),
            'ò' => Ok(Char437(149)),
            'û' => Ok(Char437(150)),
            'ù' => Ok(Char437(151)),
            'ÿ' => Ok(Char437(152)),
            'Ö' => Ok(Char437(153)),
            'Ü' => Ok(Char437(154)),
            '¢' => Ok(Char437(155)),
            '£' => Ok(Char437(156)),
            '¥' => Ok(Char437(157)),
            '₧' => Ok(Char437(158)),
            'ƒ' => Ok(Char437(159)),
            'á' => Ok(Char437(160)),
            'í' => Ok(Char437(161)),
            'ó' => Ok(Char437(162)),
            'ú' => Ok(Char437(163)),
            'ñ' => Ok(Char437(164)),
            'Ñ' => Ok(Char437(165)),
            'ª' => Ok(Char437(166)),
            'º' => Ok(Char437(167)),
            '¿' => Ok(Char437(168)),
            '⌐' => Ok(Char437(169)),
            '¬' => Ok(Char437(170)),
            '½' => Ok(Char437(171)),
            '¼' => Ok(Char437(172)),
            '¡' => Ok(Char437(173)),
            '«' => Ok(Char437(174)),
            '»' => Ok(Char437(175)),
            '░' => Ok(Char437(176)),
            '▒' => Ok(Char437(177)),
            '▓' => Ok(Char437(178)),
            '│' => Ok(Char437(179)),
            '┤' => Ok(Char437(180)),
            '╡' => Ok(Char437(181)),
            '╢' => Ok(Char437(182)),
            '╖' => Ok(Char437(183)),
            '╕' => Ok(Char437(184)),
            '╣' => Ok(Char437(185)),
            '║' => Ok(Char437(186)),
            '╗' => Ok(Char437(187)),
            '╝' => Ok(Char437(188)),
            '╜' => Ok(Char437(189)),
            '╛' => Ok(Char437(190)),
            '┐' => Ok(Char437(191)),
            '└' => Ok(Char437(192)),
            '┴' => Ok(Char437(193)),
            '┬' => Ok(Char437(194)),
            '├' => Ok(Char437(195)),
            '─' => Ok(Char437(196)),
            '┼' => Ok(Char437(197)),
            '╞' => Ok(Char437(198)),
            '╟' => Ok(Char437(199)),
            '╚' => Ok(Char437(200)),
            '╔' => Ok(Char437(201)),
            '╩' => Ok(Char437(202)),
            '╦' => Ok(Char437(203)),
            '╠' => Ok(Char437(204)),
            '═' => Ok(Char437(205)),
            '╬' => Ok(Char437(206)),
            '╧' => Ok(Char437(207)),
            '╨' => Ok(Char437(208)),
            '╤' => Ok(Char437(209)),
            '╥' => Ok(Char437(210)),
            '╙' => Ok(Char437(211)),
            '╘' => Ok(Char437(212)),
            '╒' => Ok(Char437(213)),
            '╓' => Ok(Char437(214)),
            '╫' => Ok(Char437(215)),
            '╪' => Ok(Char437(216)),
            '┘' => Ok(Char437(217)),
            '┌' => Ok(Char437(218)),
            '█' => Ok(Char437(219)),
            '▄' => Ok(Char437(220)),
            '▌' => Ok(Char437(221)),
            '▐' => Ok(Char437(222)),
            '▀' => Ok(Char437(223)),
            'α' => Ok(Char437(224)),
            'ß' => Ok(Char437(225)),
            'Γ' => Ok(Char437(226)),
            'π' => Ok(Char437(227)),
            'Σ' => Ok(Char437(228)),
            'σ' => Ok(Char437(229)),
            'µ' => Ok(Char437(230)),
            'τ' => Ok(Char437(231)),
            'Φ' => Ok(Char437(232)),
            'Θ' => Ok(Char437(233)),
            'Ω' => Ok(Char437(234)),
            'δ' => Ok(Char437(235)),
            '∞' => Ok(Char437(236)),
            'φ' => Ok(Char437(237)),
            'ε' => Ok(Char437(238)),
            '∩' => Ok(Char437(239)),
            '≡' => Ok(Char437(240)),
            '±' => Ok(Char437(241)),
            '≥' => Ok(Char437(242)),
            '≤' => Ok(Char437(243)),
            '⌠' => Ok(Char437(244)),
            '⌡' => Ok(Char437(245)),
            '÷' => Ok(Char437(246)),
            '≈' => Ok(Char437(247)),
            '°' => Ok(Char437(248)),
            '∙' => Ok(Char437(249)),
            '·' => Ok(Char437(250)),
            '√' => Ok(Char437(251)),
            'ⁿ' => Ok(Char437(252)),
            '²' => Ok(Char437(253)),
            '■' => Ok(Char437(254)),
            '\u{a0}' => Ok(Char437(255)),
            _ => Err(()),
        }
    }
}

impl TryFrom<char> for Char437 {
    type Error = ();

    #[inline]
    fn try_from(value : char) -> Result<Self, Self::Error> {
        Self::try_from(&value)
    }
}

impl fmt::Display for Char437 {
    fn fmt(&self, f : &mut fmt::Formatter<'_>) -> fmt::Result {
        writeln!(f, "{}", char::from(self))
    }
}

pub trait CP437CharExt {
    fn is_cp437(&self) -> bool;

    fn to_cp437_byte(&self) -> Option<u8>;

    fn to_cp437(&self) -> Option<Char437>;
}

impl CP437CharExt for char {
    fn is_cp437(&self) -> bool {
        CP437CHARS.contains(self)
    }

    fn to_cp437_byte(&self) -> Option<u8> {
        Some(Char437::try_from(self).ok()?.0)
    }

    fn to_cp437(&self) -> Option<Char437> {
        Char437::try_from(self).ok()
    }
}
